function thresh = psymet( subcode )% PSYMET  Find psychometric function and threshold from othresh experiment% % thresh = psymet( subcode )% set default subject codeif nargin<1    subcode='jfk';end% load datafname = sprintf('ot_%s.txt',subcode);data = load(fname,'-ascii');% get contrast and correctness columnscst = data(:,3);correct = data(:,6);% step through contrastscstlist = unique(cst)';for i = 1:numel(cstlist)        % find number of trials and proportion correct at this contrast level    f = cst==cstlist(i);    ntrials(i) = sum(f);    ncorrect(i) = sum(correct(f));    pcorrect(i) = mean(correct(f));    end% plot empirical psychometric functionclf;plot(cstlist,pcorrect,'ro');hold on;set(gca,'YLim',[ 0.40 1.10 ]);xlabel 'stimulus contrast'ylabel 'proportion correct'% fit psychometric functionfitfn = @( x, mu, sigma ) 0.50 + 0.50*normcdf( x, mu, sigma );errfn = @( p ) -sum(log( binopdf( ncorrect, ntrials, fitfn( cstlist, p(1), p(2) ) ) ));phat = fminsearch( errfn, [ 0.05 0.05 ] );% get thresholdthresh = phat(1);% plot psychometric function and thresholdfplot( @( x ) fitfn( x, phat(1), phat(2) ), [ 0 0.15 ] );plot([ thresh thresh ],[ 0.4 1.1 ],'r-');hold off;return