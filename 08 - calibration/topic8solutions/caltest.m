% CALTEST.M  Test monitor calibrationclear; clc;%% part 1 -- set up% load calibration dataload caldata.mat% set viewing distanceviewdistM = 0.57;% set preferencesScreen('Preference','SkipSyncTests',2);Screen('Preference','SuppressAllWarnings',1);% open windowbggrey = 128; % background greylevel[winID,winRect] = Screen('OpenWindow',0,bggrey);HideCursor;ListenChar(2);% null the clutclut = repmat((0:255)'/255,[ 1 3 ]);Screen('LoadNormalizedGammaTable',winID,clut);%% part 2 -- check stimulus durations% step through stimulus durationsasklist_dur = linspace(0.1,4.0,5);getlist_dur = [];for dur = asklist_dur        % flip through appropriate number of frames    nframes = cal.framerate * dur;    Screen('Flip',winID);    t1 = GetSecs;    for i = 1:nframes        Screen('DrawText',winID,'Checking stimulus durations ...',100,100,255);        Screen('Flip',winID);    end    t2 = GetSecs;        % see how long it took    getlist_dur(end+1) = t2-t1;    end%% part 3 -- check stimulus sizes% step through stimulus sizes in metersasklist_size = linspace(0.01,0.20,5);getlist_size = [];for size = asklist_size        % show square    npixels = size/cal.pixelsize;    drawRect = CenterRect( [ 0 0 npixels npixels ], winRect );    Screen(winID,'FillRect',bggrey);    Screen(winID,'FillRect',255,drawRect);        % get square size in meters    getlist_size(end+1) = str2double( GetEchoString(winID,'Enter square size (m):  ',100,100,255,bggrey) );    end%% part 4 -- check luminances% calculate position of test patchdrawRect = CenterRect( [ 0 0 200 200 ], winRect );% make inverse gamma functionminlum = cal.phat(4);maxlum = cal.phat(1)+cal.phat(4);igammafn = @( lum ) (255-cal.phat(2))*power( (max(min(lum,maxlum),minlum)-cal.phat(4))/cal.phat(1), 1/cal.phat(3) ) + cal.phat(2);% step through luminancesasklist_lum = linspace(10,100,5);getlist_lum = [];for lum = asklist_lum        % calculate greylevel    glevel = igammafn( lum );        % show square    Screen(winID,'FillRect',bggrey);    Screen(winID,'FillRect',glevel,drawRect);       % get luminance    getlist_lum(end+1) = str2double( GetEchoString(winID,'Enter luminance (cd/m^2):  ',100,100,255,bggrey) );    end%% part 5 -- show results% show stimulus duration datafigure(1);plot(asklist_dur,getlist_dur,'ro'); hold on;xlim=get(gca,'XLim');plot(xlim,xlim,'k:'); hold off;xlabel 'requested duration (seconds)'ylabel 'actual duration (seconds)'% check stimulus size datafigure(2);plot(asklist_size,getlist_size,'ro'); hold on;xlim=get(gca,'XLim');plot(xlim,xlim,'k:'); hold off;xlabel 'requested size (m)'ylabel 'actual size (m)'% check luminance datafigure(3);plot(asklist_lum,getlist_lum,'ro'); hold on;xlim=get(gca,'XLim');plot(xlim,xlim,'k:'); hold off;xlabel 'requested luminance (cd/m^2)'ylabel 'actual luminance (cd/m^2)'